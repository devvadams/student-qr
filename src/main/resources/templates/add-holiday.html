
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${holiday != null && holiday.id != null ? 'Edit Holiday' : 'Add Holiday'}">Add Holiday</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container">
    <a class="navbar-brand" href="/dashboard">
      <i class="fas fa-qrcode"></i> Student QR System
    </a>
    <div class="navbar-nav">
      <a class="nav-link" href="/dashboard">Dashboard</a>
      <a class="nav-link" href="/holidays">Holidays</a>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header" th:class="${holiday != null && holiday.id != null ? 'bg-warning text-dark' : 'bg-primary text-white'}">
          <h4 class="mb-0">
            <i class="fas fa-calendar-plus"></i>
            <span th:text="${holiday != null && holiday.id != null ? 'Edit Holiday' : 'Add New Holiday'}"></span>
          </h4>
        </div>
        <div class="card-body">
          <form th:action="${holiday != null && holiday.id != null ? '/holidays/update/' + holiday.id : '/holidays/add'}"
                method="post">

            <!-- Basic Information -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Holiday Name *</label>
                <input type="text" class="form-control" name="name" required
                       th:value="${holiday != null ? holiday.name : ''}">
              </div>
              <div class="col-md-6">
                <label class="form-label">Holiday Type *</label>
                <select class="form-select" name="type" required id="holidayType">
                  <option value="PUBLIC_HOLIDAY"
                          th:selected="${holiday != null && holiday.type == 'PUBLIC_HOLIDAY'}">
                    Public Holiday
                  </option>
                  <option value="SCHOOL_HOLIDAY"
                          th:selected="${holiday != null && holiday.type == 'SCHOOL_HOLIDAY'}">
                    School Holiday
                  </option>
                  <option value="VACATION"
                          th:selected="${holiday != null && holiday.type == 'VACATION'}">
                    Vacation
                  </option>
                  <option value="SPECIAL_EVENT"
                          th:selected="${holiday != null && holiday.type == 'SPECIAL_EVENT'}">
                    Special Event
                  </option>
                  <option value="SCHOOL_ACTIVITY"
                          th:selected="${holiday != null && holiday.type == 'SCHOOL_ACTIVITY'}">
                    School Activity
                  </option>
                  <option value="EXAMINATION"
                          th:selected="${holiday != null && holiday.type == 'EXAMINATION'}">
                    Examination
                  </option>
                  <option value="BREAK"
                          th:selected="${holiday != null && holiday.type == 'BREAK'}">
                    Break
                  </option>
                  <option value="CUSTOM"
                          th:selected="${holiday != null && holiday.type == 'CUSTOM'}">
                    Custom
                  </option>
                </select>
              </div>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="2"
                        th:text="${holiday != null ? holiday.description : ''}"></textarea>
            </div>

            <!-- Date Range -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Start Date *</label>
                <input type="date" class="form-control" name="holidayDate" required
                       th:value="${holiday != null ? #temporals.format(holiday.holidayDate, 'yyyy-MM-dd') : #temporals.format(#dates.createNow(), 'yyyy-MM-dd')}"
                       id="startDate">
              </div>
              <div class="col-md-6">
                <label class="form-label">End Date (Optional)</label>
                <input type="date" class="form-control" name="endDate"
                       th:value="${holiday != null && holiday.endDate != null ? #temporals.format(holiday.endDate, 'yyyy-MM-dd') : ''}"
                       id="endDate">
                <small class="text-muted">Leave empty for single day holiday</small>
              </div>
            </div>

            <!-- Advanced Settings -->
            <div class="accordion mb-3" id="advancedSettings">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button"
                          data-bs-toggle="collapse" data-bs-target="#collapseAdvanced">
                    <i class="fas fa-cog me-2"></i> Advanced Settings
                  </button>
                </h2>
                <div id="collapseAdvanced" class="accordion-collapse collapse"
                     data-bs-parent="#advancedSettings">
                  <div class="accordion-body">

                    <!-- Attendance Settings -->
                    <div class="row mb-3">
                      <div class="col-md-6">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox"
                                 name="noAttendance" id="noAttendance"
                                 th:checked="${holiday != null ? holiday.noAttendance : true}">
                          <label class="form-check-label" for="noAttendance">
                            No Attendance Marking
                          </label>
                        </div>
                        <small class="text-muted d-block">
                          If checked, attendance cannot be marked on these days
                        </small>
                      </div>
                      <div class="col-md-6">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox"
                                 name="autoMarkAttendance" id="autoMarkAttendance"
                                 th:checked="${holiday != null ? holiday.autoMarkAttendance : false}">
                          <label class="form-check-label" for="autoMarkAttendance">
                            Auto-mark Attendance
                          </label>
                        </div>
                        <small class="text-muted d-block">
                          Automatically mark attendance for all students
                        </small>
                      </div>
                    </div>

                    <!-- Auto-mark Settings -->
                    <div id="autoMarkSettings" class="row mb-3" style="display: none;">
                      <div class="col-md-6">
                        <label class="form-label">Mark as</label>
                        <select class="form-select" name="attendanceStatus">
                          <option value="PRESENT"
                                  th:selected="${holiday != null && holiday.attendanceStatus == 'PRESENT'}">
                            Present
                          </option>
                          <option value="ABSENT"
                                  th:selected="${holiday == null || holiday.attendanceStatus == 'ABSENT'}">
                            Absent
                          </option>
                          <option value="EXCUSED"
                                  th:selected="${holiday != null && holiday.attendanceStatus == 'EXCUSED'}">
                            Excused
                          </option>
                          <option value="LATE"
                                  th:selected="${holiday != null && holiday.attendanceStatus == 'LATE'}">
                            Late
                          </option>
                        </select>
                      </div>
                    </div>

                    <!-- School Activity Settings -->
                    <div class="row mb-3">
                      <div class="col-md-6">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox"
                                 name="schoolActivity" id="schoolActivity"
                                 th:checked="${holiday != null ? holiday.schoolActivity : false}">
                          <label class="form-check-label" for="schoolActivity">
                            School Activity Day
                          </label>
                        </div>
                        <small class="text-muted d-block">
                          For sports day, competitions, etc.
                        </small>
                      </div>
                      <div class="col-md-6">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox"
                                 name="affectsResumption" id="affectsResumption"
                                 th:checked="${holiday != null ? holiday.affectsResumption : false}">
                          <label class="form-check-label" for="affectsResumption">
                            Affects School Resumption
                          </label>
                        </div>
                        <small class="text-muted d-block">
                          School will resume on a different date
                        </small>
                      </div>
                    </div>

                    <!-- Activity Description -->
                    <div class="mb-3">
                      <label class="form-label">Activity Description</label>
                      <textarea class="form-control" name="activityDescription" rows="2"
                                th:text="${holiday != null ? holiday.activityDescription : ''}"
                                placeholder="Details about school activity..."></textarea>
                    </div>

                    <!-- Resumption Date -->
                    <div id="resumptionSettings" class="row mb-3" style="display: none;">
                      <div class="col-md-6">
                        <label class="form-label">School Resumes On</label>
                        <input type="date" class="form-control" name="resumptionDate"
                               th:value="${holiday != null && holiday.resumptionDate != null ? #temporals.format(holiday.resumptionDate, 'yyyy-MM-dd') : ''}">
                      </div>
                    </div>

                    <!-- Other Settings -->
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox"
                                 name="recurringYearly" id="recurringYearly"
                                 th:checked="${holiday != null ? holiday.recurringYearly : false}">
                          <label class="form-check-label" for="recurringYearly">
                            Recur Yearly
                          </label>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox"
                                 name="active" id="active"
                                 th:checked="${holiday != null ? holiday.active : true}">
                          <label class="form-check-label" for="active">
                            Active
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between">
              <a href="/holidays" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Cancel
              </a>
              <button type="submit" class="btn"
                      th:class="${holiday != null && holiday.id != null ? 'btn-warning' : 'btn-primary'}">
                <i class="fas fa-save"></i>
                <span th:text="${holiday != null && holiday.id != null ? 'Update Holiday' : 'Add Holiday'}"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="bg-light mt-5 py-3">
  <div class="container text-center">
    <p class="text-muted mb-0">
      <i class="fas fa-qrcode"></i> Student QR System &copy; 2024
    </p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const holidayTypeSelect = document.getElementById('holidayType');
    const autoMarkCheckbox = document.getElementById('autoMarkAttendance');
    const autoMarkSettings = document.getElementById('autoMarkSettings');
    const resumptionCheckbox = document.getElementById('affectsResumption');
    const resumptionSettings = document.getElementById('resumptionSettings');

    // Set end date to start date if not set
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');

    if (startDateInput && !endDateInput.value) {
      endDateInput.value = startDateInput.value;
    }

    // Update end date when start date changes
    startDateInput.addEventListener('change', function() {
      if (!endDateInput.value || endDateInput.value < this.value) {
        endDateInput.value = this.value;
      }
    });

    // Show/hide auto-mark settings
    autoMarkCheckbox.addEventListener('change', function() {
      autoMarkSettings.style.display = this.checked ? 'block' : 'none';
    });

    // Show/hide resumption settings
    resumptionCheckbox.addEventListener('change', function() {
      resumptionSettings.style.display = this.checked ? 'block' : 'none';
    });

    // Set default settings based on holiday type
    holidayTypeSelect.addEventListener('change', function() {
      const type = this.value;

      // Set defaults for different types
      switch(type) {
        case 'VACATION':
          autoMarkCheckbox.checked = true;
          resumptionCheckbox.checked = true;
          autoMarkSettings.style.display = 'block';
          resumptionSettings.style.display = 'block';
          break;
        case 'SCHOOL_ACTIVITY':
          autoMarkCheckbox.checked = true;
          document.querySelector('[name="attendanceStatus"]').value = 'PRESENT';
          autoMarkSettings.style.display = 'block';
          break;
        default:
          autoMarkCheckbox.checked = false;
          resumptionCheckbox.checked = false;
          autoMarkSettings.style.display = 'none';
          resumptionSettings.style.display = 'none';
      }
    });

    // Trigger change event on load if editing
    if (holidayTypeSelect.value) {
      holidayTypeSelect.dispatchEvent(new Event('change'));
    }
    if (autoMarkCheckbox.checked) {
      autoMarkCheckbox.dispatchEvent(new Event('change'));
    }
    if (resumptionCheckbox.checked) {
      resumptionCheckbox.dispatchEvent(new Event('change'));
    }
  });
</script>
</body>
</html>